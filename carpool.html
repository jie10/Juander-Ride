<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juander | Shuttle Service Ride Application </title>
    <link rel="icon" type="image/x-icon" href="./images/icons/juander-icon.ico">
    <link href="index.css" rel="stylesheet" type="text/css" />
    <link href="index.mobile.css" rel="stylesheet" type="text/css" />
    <!-- FONTAWESOME-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- BOOTSTRAP-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" integrity="sha512-GQGU0fMMi238uA+a/bdWJfpUGKUkBdgfFdgBm72SUQ6BeyWjoY/ton0tEjH+OSH9iP4Dfh+7HM0I9f5eR0L/4w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js" integrity="sha512-pax4MlgXjHEPfCwcJLQhigY7+N8rt6bVvWLFyUMuxShv170X53TRzGPmPkZmGBhk+jikR8WBM4yl7A9WMHHqvg==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <!-- SWAL 2-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.8/sweetalert2.min.css" integrity="sha512-y4S4cBeErz9ykN3iwUC4kmP/Ca+zd8n8FDzlVbq5Nr73gn1VBXZhpriQ7avR+8fQLpyq4izWm0b8s6q4Vedb9w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.8/sweetalert2.min.js" integrity="sha512-7x7HoEikRZhV0FAORWP+hrUzl75JW/uLHBbg2kHnPdFmScpIeHY0ieUVSacjusrKrlA/RsA2tDOBvisFmKc3xw==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <!-- HTML5 QR code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.2.0/html5-qrcode.min.js" defer></script>
    <!-- TOM SELECT -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tom-select/2.0.3/css/tom-select.min.css" integrity="sha512-HZ7LD8/WlBbdwTrhR7B+tpXfuD21i53SQbzDYeQLKpftG7qfsKKOoSVlm582hTHd5d/R1/qvpqiW6/grsJ6xrQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tom-select/2.0.2/js/tom-select.complete.js" integrity="sha512-XmIHhMRKPvdOCojjxP/m6kxwBhBrT+eMIDjzCojVdkoOF0DseV+7KfFZeW7HtZ48yrW7Keu/EBoGTLMeYtfjLg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- BING MAPS -->
    <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap' async defer></script>
</head>
<body>
    <div class="container-fluid d-flex flex-column" style="min-height: 100vh;">
        <div class="row p-2 main-top-navbar" id="main_top_navbar">
            <div class="col"></div>
            <div class="col-6 d-flex my-auto justify-content-center">
                <span class="h3" style="color: #0066A3; margin-bottom: 0;">Juander</span>
            </div>
            <div class="col"></div>
        </div>
        <div class="row p-2 secondary-top-navbar" id="secondary_top_navbar" style="display: none;">
            <div class="col d-flex justify-content-start">
                <button type="button" class="btn btn-primary-outline" id="back_to_previous_page_button" style="color: #373737;">
                    <i class="fa-solid fa-arrow-left-long"></i>
                </button>
            </div>
            <div class="col-6 d-flex my-auto justify-content-center">
                <span class="h4" style="color: #0066A3; margin-bottom: 0;">Juander</span>
            </div>
            <div class="col"></div>
        </div>
        <div class="row" style="flex-grow: 1;">
            <div class="container carpool-container tab-page-active" id="carpool_container">
                <div class="carpool-main-page" id="carpool_main_page">
                    <div class="more-carpool-buttons d-flex">
                        <button type="button" class="btn btn-light carpool-ride-list-button active-tab-button" id="carpool_ride_list_button">Find Carpool</button>
                        <button type="button" class="btn btn-light share-a-ride-button" id="share_a_ride_button">Share a Ride</button>
                    </div>
                    <div class="carpool-ride-list-container" id="carpool_ride_list_container" style="display: block;">
                        <p class="text-muted no-carpool-rides-found absolute-center text-center">There are currently no vehicles nearby</p>
                    </div>
                    <div class="share-a-ride-container" id="share_a_ride_container" style="display: none;">
                        <p class="text-muted no-carpool-rides-found absolute-center text-center">HiThere are currently no vehicles nearby</p>
                    </div>
                </div>
                <div class="carpool-page-loader d-flex justify-content-center m-5" id="carpool_page_loader" style="display: none !important;">
                    <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status"><span class="sr-only">Loading...</span></div>
                </div>  
            </div>
            <div class="container p-3 error-container" id="error_page"></div>
        </div>
        <div class="row main-bottom-navbar" id="main_bottom_navbar">
            <div class="col" style="background-color: #FFFFFF; border-top: 1px solid #C0CED8;">
                <div class="container">
                    <div class="row">
                        <a class="col text-center p-3 d-flex flex-column carpool-tab-button tab-active" id="carpool_tab_button" href="./carpool.html">
                            <i class="fa-solid fa-car-side"></i>Carpool
                        </a>
                        <a class="col text-center p-3 d-flex flex-column shuttle-tab-button" id="shuttle_tab_button" href="./shuttle.html">
                            <i class="fa-solid fa-van-shuttle"></i>Shuttle
                        </a>
                        <a class="col text-center p-3 d-flex flex-column user-account-tab-button" id="user_account_tab_button" href="./account.html">
                            <i class="fa-solid fa-user"></i>Account
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="./data.js"></script>
    <script type="text/javascript">
        var main_top_navbar = document.getElementById('main_top_navbar');
        var main_bottom_navbar = document.getElementById('main_bottom_navbar');
        var secondary_top_navbar = document.getElementById('secondary_top_navbar');
        var carpool_page_loader = document.getElementById('carpool_page_loader');
        var carpool_container = document.getElementById('carpool_container');
        var shuttle_container = document.getElementById('shuttle_container');
        var user_account_container = document.getElementById('user_account_container');
        var carpool_ride_list_container = document.getElementById('carpool_ride_list_container');
        var share_a_ride_container = document.getElementById('share_a_ride_container');
        var carpool_main_page = document.getElementById('carpool_main_page');
        var error_page = document.getElementById('error_page');
        var carpool_tab_button = document.getElementById('carpool_tab_button');
        var shuttle_tab_button = document.getElementById('shuttle_tab_button');
        var user_account_tab_button = document.getElementById('user_account_tab_button');
        var carpool_ride_list_button = document.getElementById('carpool_ride_list_button');
        var share_a_ride_button = document.getElementById('share_a_ride_button');
        var back_to_previous_page_button = document.getElementById('back_to_previous_page_button'); 
        var carpool_ride_list_button = document.getElementById('carpool_ride_list_button');

        function delay(callback, TIMEOUT_IN_SECONDS) {
            setTimeout(callback, TIMEOUT_IN_SECONDS);
        }

        function showTimedAlertMessage(title, message, status, TIMEOUT_IN_SECONDS) {
            var Alert = Swal.mixin({
                showConfirmButton: false,
                timer: TIMEOUT_IN_SECONDS,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });
            Alert.fire(title, message, status);
        }
        function showErrorPage (error) {
            console.error(error.message);
            error_page.style.display = 'block';
            error_page.innerHTML = '<p class="text-muted absolute-center text-center">' + error.message + '</p>';
        }
        function showCarpoolPageLoader () {
            carpool_page_loader.style.display = 'flex';
        }
        function showMainBottomNavbar () {
            main_bottom_navbar.style.display = 'block';
        }
        function showToastMessage (title, status, TIMEOUT_IN_SECONDS) {
            var Toast = Swal.mixin({
                toast: true,
                position: 'top-right',
                showConfirmButton: false,
                timer: TIMEOUT_IN_SECONDS,
                timerProgressBar: true,
                didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });

            Toast.fire({
                icon: status,
                title: title
            });
        }
        function showCarpoolRideListContainer() {
            carpool_ride_list_container.style.display = 'block';
            share_a_ride_container.style.display = 'none';
        }
        function showShareARideContainer() {
            carpool_ride_list_container.style.display = 'none';
            share_a_ride_container.style.display = 'block';
        }

        function hideErrorPage () {
            error_page.style.display = 'none';
        }
        function hideCarpoolPageLoader () {
            carpool_page_loader.style.display = 'none';
        }
        function hideMainBottomNavbar () {
            main_bottom_navbar.style.display = 'none';
        }

        function loadCarpoolRidesList () {
            var withResults = '<div class=\"container carpool-rides-list\">' +
                                    carpools.map(function (ride) {
                                        return '<div class=\"row item\">'
                                                    + '<div class=\"col d-flex justify-content-center align-items-center\">'
                                                        + '<div class=\"main-details text-center\"">' 
                                                            + '<span class=\"icon d-block\">' + (ride.ride_type === 'car' ? '<i class="fa-solid fa-car-side"></i>' : '<i class="fa-solid fa-motorcycle"></i>') + '</span>' 
                                                            + '<h4 class=\"value\"">' + ride.plate_number + '</h4>'
                                                        + '</div>'
                                                    + '</div>'
                                                    + '<div class=\"col-12 col-lg\">'
                                                        + '<div class=\"details\">' 
                                                            + '<span class=\"label\">Type / Color</span>' 
                                                            + '<span class=\"value\">' + ride.vehicle_type.toUpperCase() + ' / ' + ride.vehicle_color.toUpperCase() + '</span>' 
                                                        + '</div>'
                                                        + '<div class=\"details\">' 
                                                            + '<span class=\"label\">Brand / Model</span>' 
                                                            + '<span class=\"value\">' + ride.vehicle_brand.toUpperCase() + ' / ' + ride.vehicle_model + '</span>' 
                                                        + '</div>'
                                                        + '<div class=\"details\">' 
                                                            + '<span class=\"label\">Available Seats</span>' 
                                                            + '<span class=\"value\">' + ride.available_seats + ' out of ' + ride.passenger_capacity  + '</span>' 
                                                        + '</div>'
                                                    + '</div>'
                                                    + '<div class=\"col-12 col-lg\">'
                                                        + '<div class=\"d-flex justify-content-center justify-content-lg-start\">'
                                                            + '<button type=\"button\" id=\"' + ride._id + '\" class=\"btn btn-primary mt-3 mb-3 request-a-ride-button\">Request</button>' 
                                                        + '</div>'
                                                        + '<div class=\"details\">' 
                                                            + '<span class=\"label\">Pick-up Point / Location</span>' 
                                                            + '<span class=\"value\">' 
                                                                + '<i class="fa-solid fa-location-dot"></i><a class=\"pick-up-location-link\" target=\"_blank\" href=\"https://maps.google.com/?q=' + ride.pick_up_location + '\">' + ride.pick_up_point + ' / ' + ride.location.toUpperCase() + '</a>' 
                                                            + '</span>' 
                                                        + '</div>'
                                                        
                                                    + '</div>'
                                                + '</div>';
                                    }).join('\n');
                                + '</div>';
            var noResults = '<p class=\"text-muted no-carpool-rides-found absolute-center text-center\">There are currently no vehicles nearby</p>';
            return carpools.length > 0 ? withResults : noResults;
        }

        function reloadCarpoolPage () {
            showMainBottomNavbar();
            main_top_navbar.style.display = 'flex';
            secondary_top_navbar.style.display = 'none';
            carpool_main_page.style.display = 'block';
            error_page.style.display = 'none';
        }

        function openRideList () {
            hideMainBottomNavbar();
            carpool_ride_list_container.style.display = 'block';
            secondary_top_navbar.style.display = 'flex';
            main_top_navbar.style.display = 'none';
            carpool_main_page.style.display = 'none';
            carpool_ride_list_container.innerHTML = loadCarpoolRidesList();
            document.querySelectorAll('.request-a-ride-button').forEach(function (btn) {
                btn.addEventListener('click', function (e) {
                    showTimedAlertMessage('Request Successful', 'Estimated waiting time is 25 minutes!', 'success', 2000);
                    reloadCarpoolPage();
                });
            });
        }

        function onCarpoolRidelist () {
            if (share_a_ride_button.classList.contains('active-tab-button')) {
                share_a_ride_button.classList.remove('active-tab-button');
            }

            carpool_ride_list_button.classList.add('active-tab-button');
            showCarpoolRideListContainer();
        }
        function onShareCarpoolRide () {
            if (carpool_ride_list_button.classList.contains('active-tab-button')) {
                carpool_ride_list_button.classList.remove('active-tab-button');
            }

            share_a_ride_button.classList.add('active-tab-button');
            showShareARideContainer();
        }

        back_to_previous_page_button.addEventListener('click', reloadCarpoolPage);
        carpool_ride_list_button.addEventListener('click', onCarpoolRidelist);
        share_a_ride_button.addEventListener('click', onShareCarpoolRide)

        document.addEventListener('DOMContentLoaded', function () {
            reloadCarpoolPage(); 
        });
    </script>
</body>
</html>