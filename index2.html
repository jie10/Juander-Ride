<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juander | Shuttle Service Ride Application </title>
    <link rel="icon" type="image/x-icon" href="./images/icons/juander-icon.ico">
    <!-- <link href="./styles/css/index.css" rel="stylesheet" type="text/css" /> -->
    <!-- FONTAWESOME-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./styles/lib/all.min.css" />
    <!-- BOOTSTRAP-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" integrity="sha512-GQGU0fMMi238uA+a/bdWJfpUGKUkBdgfFdgBm72SUQ6BeyWjoY/ton0tEjH+OSH9iP4Dfh+7HM0I9f5eR0L/4w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./styles/lib/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js" integrity="sha512-pax4MlgXjHEPfCwcJLQhigY7+N8rt6bVvWLFyUMuxShv170X53TRzGPmPkZmGBhk+jikR8WBM4yl7A9WMHHqvg==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <script src="./scripts/lib/bootstrap.min.js" defer></script>
    <!-- SWAL 2-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.8/sweetalert2.min.css" integrity="sha512-y4S4cBeErz9ykN3iwUC4kmP/Ca+zd8n8FDzlVbq5Nr73gn1VBXZhpriQ7avR+8fQLpyq4izWm0b8s6q4Vedb9w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./styles/lib/sweetalert2.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.8/sweetalert2.min.js" integrity="sha512-7x7HoEikRZhV0FAORWP+hrUzl75JW/uLHBbg2kHnPdFmScpIeHY0ieUVSacjusrKrlA/RsA2tDOBvisFmKc3xw==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <script src="./scripts/lib/sweetalert2.min.js" defer></script>
    <!-- HTML5 QR code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.2.0/html5-qrcode.min.js" defer></script>
    <script src="./scripts/lib/html5-qrcode.min.js" defer></script>
    <style>
        .carpool-container,
        .shuttle-container {
            display: none;
        }
        .carpool-container {
            position: relative;
            background-image: url('./images/sample/google_map.png');
            background-position: center;
            background-size: cover;
        }
        .more-carpool-buttons {
            position: fixed;
            width: fit-content;
            background-color: #FFFFFF;
            margin-right: 16px;
            top: 80px;
            right: 0;
            border-radius: 16px;
        }
        .scan-qr-carpool-button {
            position: fixed;
            width: 250px;
            bottom: 50px;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .carpool-vehicle-id-input {
            width: 250px !important;
            margin: auto;
        }
        .submit-vehicle-id-button {
            width: 250px !important;
            margin: auto;
        }
        .tab-page-active {
            display: block;
        }
        .carpool-tab-button,
        .shuttle-tab-button {
            color: #373737;
            font-size: 14px;
            cursor: pointer;
        }
        .tab-active {
            color: #0066A3;
        }
        .main-top-navbar,
        .secondary-top-navbar {
            background-color: #FFCD00;
        }
        .active-navbar {
            display: block;
        }
        .carpool-main-page,
        .carpool-scan-to-ride-page {
            height: 100%;
        }
        .scan-qr-to-ride-reader {
            width: 450px;
            margin: 0 auto;
        }
        @media only screen and (max-width: 480px) { 
            .scan-qr-carpool-button,
            .submit-vehicle-id-button,
            .carpool-vehicle-id-input  {
                width: 80% !important;
            }
            .scan-qr-to-ride-reader  {
                width: 350px;
            }
        }
        @media only screen and (max-width: 320px) { 
            .scan-qr-to-ride-reader  {
                width: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid d-flex flex-column" style="min-height: 100vh;">
        <div class="row p-2 main-top-navbar" id="main_top_navbar">
            <div class="col-6">
                <span class="h3" style="color: #0066A3;">Juander</span>
            </div>
            <div class="col d-flex justify-content-end">
                <button type="button" class="btn btn-primary-outline" style="color: #373737;"><i class="fa-solid fa-ellipsis-vertical"></i></button>
            </div>
        </div>
        <div class="row p-2 secondary-top-navbar" id="secondary_top_navbar" style="display: none;">
            <div class="col d-flex justify-content-start">
                <button type="button" class="btn btn-primary-outline" id="back_to_previous_carpool_button" style="color: #373737;">
                    <i class="fa-solid fa-arrow-left-long"></i>
                </button>
            </div>
            <div class="col-6 d-flex justify-content-center">
                <span class="h4" style="color: #0066A3;">Juander</span>
            </div>
            <div class="col"></div>
        </div>
        <div class="row" style="flex-grow: 1;">
            <div class="container p-3 carpool-container tab-page-active" id="carpool_container">
                <div class="carpool-main-page" id="carpool_main_page">
                    <div class="more-carpool-buttons d-flex flex-column">
                        <button type="button" class="btn btn-light"><i class="fa-solid fa-location-arrow"></i></button>
                        <button type="button" class="btn btn-light"><i class="fa-solid fa-bars-staggered"></i></button>
                    </div>
                    <button class="btn btn-primary scan-qr-carpool-button" type="button" id="scan_qr_carpool_button">
                        <i class="fa-solid fa-qrcode me-2"></i>
                        Scan QR Code to Ride
                    </button>
                </div>
                <div class="carpool-page-loader d-flex justify-content-center m-5" id="carpool_page_loader" style="display: none !important;">
                    <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status"><span class="sr-only">Loading...</span></div>
                </div>
                <div class="carpool-scan-to-ride-page" id="carpool_scan_to_ride_page" style="display: none;">
                    <div class="scan-qr-to-ride-reader" id="scan_qr_to_ride_reader"></div>
                    <p class="text-center pt-3 pb-3">Scan driver's QR code or enter vehicle ID to ride</p>
                    <div class="form-group text-center">
                        <input type="text" class="form-control d-flex justify-content-center carpool-vehicle-id-input" id="carpool_vehicle_id_input" aria-describedby="carpool_vehicle_id_help" placeholder="Enter vehicle ID">
                        <small id="carpool_vehicle_id_help" class="form-text text-muted">You can find Vehicle ID from the bottom of QR Code</small>
                    </div>
                    <button type="submit" class="btn btn-primary submit-vehicle-id-button mt-3 mb-3 d-flex justify-content-center" id="submit_vehicle_id_button">Submit</button>
                </div>
            </div>
            <div class="container p-3 shuttle-container" id="shuttle_container">
                <p>This is a shuttle container!</p>
            </div>
        </div>
        <div class="row">
            <div class="col" style="background-color: #FFFFFF; border-top: 1px solid #C0CED8;">
                <div class="container">
                    <div class="row">
                        <div class="col text-center p-2 d-flex flex-column tab-active carpool-tab-button" id="carpool_tab_button">
                            <i class="fa-solid fa-car-side"></i>Carpool
                        </div>
                        <div class="col text-center p-2 d-flex flex-column shuttle-tab-button" id="shuttle_tab_button">
                            <i class="fa-solid fa-van-shuttle"></i>Shuttle
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var main_top_navbar = document.getElementById('main_top_navbar');
        var secondary_top_navbar = document.getElementById('secondary_top_navbar');
        var carpool_page_loader = document.getElementById('carpool_page_loader');
        var carpool_container = document.getElementById('carpool_container');
        var shuttle_container = document.getElementById('shuttle_container');
        var carpool_main_page = document.getElementById('carpool_main_page');
        var carpool_scan_to_ride_page = document.getElementById('carpool_scan_to_ride_page');
        var carpool_tab_button = document.getElementById('carpool_tab_button');
        var shuttle_tab_button = document.getElementById('shuttle_tab_button');
        var scan_qr_carpool_button = document.getElementById('scan_qr_carpool_button');
        var submit_vehicle_id_button = document.getElementById('submit_vehicle_id_button');
        var back_to_previous_carpool_button = document.getElementById('back_to_previous_carpool_button');
        var carpool_vehicle_id_input = document.getElementById('carpool_vehicle_id_input');

        function delay(callback, TIMEOUT_IN_SECONDS) {
            setTimeout(callback, TIMEOUT_IN_SECONDS);
        }
        function showCarpoolPageLoader () {
            carpool_page_loader.style.display = 'flex';
        }
        function hideCarpoolPageLoader () {
            carpool_page_loader.style.display = 'none';
        }
        function onCarpoolTab () {
            shuttle_tab_button.classList.remove('tab-active');
            carpool_tab_button.classList.add('tab-active');
            shuttle_container.classList.remove('tab-page-active');
            carpool_container.classList.add('tab-page-active');
            backToCarpoolPage();
        }
        function onShuttleTab () {
            shuttle_tab_button.classList.add('tab-active');
            carpool_tab_button.classList.remove('tab-active');
            shuttle_container.classList.add('tab-page-active');
            carpool_container.classList.remove('tab-page-active');
            main_top_navbar.style.display = 'flex';
            secondary_top_navbar.style.display = 'none';
        }
        function backToCarpoolPage () {
            main_top_navbar.style.display = 'flex';
            secondary_top_navbar.style.display = 'none';
            carpool_scan_to_ride_page.style.display = 'none';
            carpool_main_page.style.display = 'block';
        }
        function showToastMessage (title, status, TIMEOUT_IN_SECONDS) {
            var Toast = Swal.mixin({
                toast: true,
                position: 'bottom-end',
                showConfirmButton: false,
                timer: TIMEOUT_IN_SECONDS,
                timerProgressBar: true,
                didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });

            Toast.fire({
                icon: status,
                title: title
            });
        }
        function scanQRCodeToRide () {
            var lastResult, countResults = 0;

            Html5Qrcode.getCameras().then(devices => {
                if (devices && devices.length) {
                    var html5QrCode = new Html5Qrcode('scan_qr_to_ride_reader');
                    var cameraId = devices[0].id;
                    var config = {
                        fps: 10,
                        qrbox: { width: 180, height: 180 }
                    };

                    html5QrCode.start(
                        cameraId, 
                        config,
                        function (decodedText, decodedResult) {
                            if (decodedText !== lastResult) {
                                ++countResults;
                                lastResult = decodedText;

                                var result = typeof JSON.parse(decodedText) === "string" ? JSON.parse(JSON.parse(decodedText)) : JSON.parse(decodedText);
                                console.log(result);
                            }

                            html5QrCode.clear();
                            backToCarpoolPage();
                            showToastMessage('Scan successful', 'success', 2500);
                        },
                        function (err) {
                        })
                    .catch((err) => {
                        console.error(err);
                        showToastMessage('Scan failed', 'error', 2500);
                        backToCarpoolPage();
                    });
                } else {
                    backToCarpoolPage();
                    showToastMessage('No cameras found', 'error', 2500);
                }
            })
            .catch(err => {
                console.error(err);
                backToCarpoolPage();
                showToastMessage('Camera permission blocked', 'error', 2500);
            });
        }
        function submitVehicleIDToRide () {
            showToastMessage('Submit successful', 'success', 2500);
            backToCarpoolPage();
        }
        function openQRScanToRide () {
            secondary_top_navbar.style.display = 'flex';
            main_top_navbar.style.display = 'none';
            scanQRCodeToRide();
            carpool_main_page.style.display = 'none';
            carpool_scan_to_ride_page.style.display = 'block';

            submit_vehicle_id_button.disabled = true;
            carpool_vehicle_id_input.disabled = true;
            delay(function () {
                carpool_vehicle_id_input.disabled = false;
                submit_vehicle_id_button.disabled = false;
            }, 1500);
        }
        function closeQRScanToRide () {
            backToCarpoolPage();
        }
        carpool_tab_button.addEventListener('click', onCarpoolTab);
        shuttle_tab_button.addEventListener('click', onShuttleTab);
        scan_qr_carpool_button.addEventListener('click', openQRScanToRide);
        submit_vehicle_id_button.addEventListener('click', submitVehicleIDToRide)
        back_to_previous_carpool_button.addEventListener('click', closeQRScanToRide);
    </script>
</body>
</html>